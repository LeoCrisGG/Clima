<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/clima/data/api/RetrofitClient.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/clima/data/api/RetrofitClient.kt" />
              <option name="originalContent" value="package com.example.clima.data.api&#10;&#10;import okhttp3.OkHttpClient&#10;import okhttp3.logging.HttpLoggingInterceptor&#10;import retrofit2.Retrofit&#10;import retrofit2.converter.gson.GsonConverterFactory&#10;import java.util.concurrent.TimeUnit&#10;&#10;object RetrofitClient {&#10;    private const val BASE_URL = &quot;https://api.openweathermap.org/data/2.5/&quot;&#10;    private const val AIR_POLLUTION_BASE_URL = &quot;https://api.openweathermap.org/data/2.5/&quot;&#10;&#10;    private val loggingInterceptor = HttpLoggingInterceptor().apply {&#10;        level = HttpLoggingInterceptor.Level.BODY&#10;    }&#10;&#10;    private val okHttpClient = OkHttpClient.Builder()&#10;        .addInterceptor(loggingInterceptor)&#10;        .connectTimeout(30, TimeUnit.SECONDS)&#10;        .readTimeout(30, TimeUnit.SECONDS)&#10;        .build()&#10;&#10;    private val retrofit = Retrofit.Builder()&#10;        .baseUrl(BASE_URL)&#10;        .client(okHttpClient)&#10;        .addConverterFactory(GsonConverterFactory.create())&#10;        .build()&#10;&#10;    val weatherApiService: WeatherApiService = retrofit.create(WeatherApiService::class.java)&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.clima.data.api&#10;&#10;import okhttp3.OkHttpClient&#10;import okhttp3.logging.HttpLoggingInterceptor&#10;import retrofit2.Retrofit&#10;import retrofit2.converter.gson.GsonConverterFactory&#10;import java.util.concurrent.TimeUnit&#10;&#10;object RetrofitClient {&#10;    private const val BASE_URL = &quot;https://api.openweathermap.org/data/2.5/&quot;&#10;    private const val GEOCODING_BASE_URL = &quot;https://api.openweathermap.org/geo/1.0/&quot;&#10;&#10;    private val loggingInterceptor = HttpLoggingInterceptor().apply {&#10;        level = HttpLoggingInterceptor.Level.BODY&#10;    }&#10;&#10;    private val okHttpClient = OkHttpClient.Builder()&#10;        .addInterceptor(loggingInterceptor)&#10;        .connectTimeout(30, TimeUnit.SECONDS)&#10;        .readTimeout(30, TimeUnit.SECONDS)&#10;        .build()&#10;&#10;    private val retrofit = Retrofit.Builder()&#10;        .baseUrl(BASE_URL)&#10;        .client(okHttpClient)&#10;        .addConverterFactory(GsonConverterFactory.create())&#10;        .build()&#10;&#10;    private val geocodingRetrofit = Retrofit.Builder()&#10;        .baseUrl(GEOCODING_BASE_URL)&#10;        .client(okHttpClient)&#10;        .addConverterFactory(GsonConverterFactory.create())&#10;        .build()&#10;&#10;    val weatherApiService: WeatherApiService = retrofit.create(WeatherApiService::class.java)&#10;    val geocodingApiService: GeocodingApiService = geocodingRetrofit.create(GeocodingApiService::class.java)&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/clima/data/api/WeatherApiService.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/clima/data/api/WeatherApiService.kt" />
              <option name="originalContent" value="package com.example.clima.data.api&#10;&#10;import com.example.clima.data.models.AirQualityResponse&#10;import com.example.clima.data.models.ForecastResponse&#10;import com.example.clima.data.models.WeatherResponse&#10;import retrofit2.http.GET&#10;import retrofit2.http.Query&#10;&#10;interface WeatherApiService {&#10;&#10;    // Clima actual por coordenadas&#10;    @GET(&quot;weather&quot;)&#10;    suspend fun getCurrentWeather(&#10;        @Query(&quot;lat&quot;) lat: Double,&#10;        @Query(&quot;lon&quot;) lon: Double,&#10;        @Query(&quot;appid&quot;) apiKey: String,&#10;        @Query(&quot;units&quot;) units: String = &quot;metric&quot;,&#10;        @Query(&quot;lang&quot;) lang: String = &quot;es&quot;&#10;    ): WeatherResponse&#10;&#10;    // Clima actual por nombre de ciudad&#10;    @GET(&quot;weather&quot;)&#10;    suspend fun getCurrentWeatherByCity(&#10;        @Query(&quot;q&quot;) city: String,&#10;        @Query(&quot;appid&quot;) apiKey: String,&#10;        @Query(&quot;units&quot;) units: String = &quot;metric&quot;,&#10;        @Query(&quot;lang&quot;) lang: String = &quot;es&quot;&#10;    ): WeatherResponse&#10;&#10;    // Pronóstico de 5 días&#10;    @GET(&quot;forecast&quot;)&#10;    suspend fun getForecast(&#10;        @Query(&quot;lat&quot;) lat: Double,&#10;        @Query(&quot;lon&quot;) lon: Double,&#10;        @Query(&quot;appid&quot;) apiKey: String,&#10;        @Query(&quot;units&quot;) units: String = &quot;metric&quot;,&#10;        @Query(&quot;lang&quot;) lang: String = &quot;es&quot;&#10;    ): ForecastResponse&#10;&#10;    // Calidad del aire&#10;    @GET(&quot;air_pollution&quot;)&#10;    suspend fun getAirQuality(&#10;        @Query(&quot;lat&quot;) lat: Double,&#10;        @Query(&quot;lon&quot;) lon: Double,&#10;        @Query(&quot;appid&quot;) apiKey: String&#10;    ): AirQualityResponse&#10;}&#10;&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.clima.data.api&#10;&#10;import com.example.clima.data.models.AirQualityResponse&#10;import com.example.clima.data.models.ForecastResponse&#10;import com.example.clima.data.models.WeatherResponse&#10;import retrofit2.http.GET&#10;import retrofit2.http.Query&#10;&#10;interface WeatherApiService {&#10;&#10;    // Clima actual por coordenadas&#10;    @GET(&quot;weather&quot;)&#10;    suspend fun getCurrentWeather(&#10;        @Query(&quot;lat&quot;) lat: Double,&#10;        @Query(&quot;lon&quot;) lon: Double,&#10;        @Query(&quot;appid&quot;) apiKey: String,&#10;        @Query(&quot;units&quot;) units: String = &quot;metric&quot;,&#10;        @Query(&quot;lang&quot;) lang: String = &quot;es&quot;&#10;    ): WeatherResponse&#10;&#10;    // Clima actual por nombre de ciudad&#10;    @GET(&quot;weather&quot;)&#10;    suspend fun getCurrentWeatherByCity(&#10;        @Query(&quot;q&quot;) city: String,&#10;        @Query(&quot;appid&quot;) apiKey: String,&#10;        @Query(&quot;units&quot;) units: String = &quot;metric&quot;,&#10;        @Query(&quot;lang&quot;) lang: String = &quot;es&quot;&#10;    ): WeatherResponse&#10;&#10;    // Pronóstico de 5 días&#10;    @GET(&quot;forecast&quot;)&#10;    suspend fun getForecast(&#10;        @Query(&quot;lat&quot;) lat: Double,&#10;        @Query(&quot;lon&quot;) lon: Double,&#10;        @Query(&quot;appid&quot;) apiKey: String,&#10;        @Query(&quot;units&quot;) units: String = &quot;metric&quot;,&#10;        @Query(&quot;lang&quot;) lang: String = &quot;es&quot;&#10;    ): ForecastResponse&#10;&#10;    // Calidad del aire&#10;    @GET(&quot;air_pollution&quot;)&#10;    suspend fun getAirQuality(&#10;        @Query(&quot;lat&quot;) lat: Double,&#10;        @Query(&quot;lon&quot;) lon: Double,&#10;        @Query(&quot;appid&quot;) apiKey: String&#10;    ): AirQualityResponse&#10;}&#10;&#10;// Nueva interfaz separada para Geocoding API&#10;interface GeocodingApiService {&#10;    // Geocoding API - Buscar ciudades&#10;    @GET(&quot;direct&quot;)&#10;    suspend fun searchCities(&#10;        @Query(&quot;q&quot;) query: String,&#10;        @Query(&quot;limit&quot;) limit: Int = 5,&#10;        @Query(&quot;appid&quot;) apiKey: String&#10;    ): List&lt;CitySearchResult&gt;&#10;    &#10;    // Geocoding Reverso - Obtener ciudad desde coordenadas&#10;    @GET(&quot;reverse&quot;)&#10;    suspend fun reverseCitySearch(&#10;        @Query(&quot;lat&quot;) lat: Double,&#10;        @Query(&quot;lon&quot;) lon: Double,&#10;        @Query(&quot;limit&quot;) limit: Int = 1,&#10;        @Query(&quot;appid&quot;) apiKey: String&#10;    ): List&lt;CitySearchResult&gt;&#10;}&#10;&#10;data class CitySearchResult(&#10;    val name: String,&#10;    val lat: Double,&#10;    val lon: Double,&#10;    val country: String,&#10;    val state: String? = null,&#10;    val local_names: Map&lt;String, String&gt;? = null&#10;)" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/clima/data/repository/WeatherRepository.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/clima/data/repository/WeatherRepository.kt" />
              <option name="originalContent" value="package com.example.clima.data.repository&#10;&#10;import com.example.clima.data.api.RetrofitClient&#10;import com.example.clima.data.models.AirQualityResponse&#10;import com.example.clima.data.models.ForecastResponse&#10;import com.example.clima.data.models.WeatherResponse&#10;&#10;class WeatherRepository {&#10;&#10;    private val apiService = RetrofitClient.weatherApiService&#10;&#10;    // Nota: Reemplaza esta API key con tu propia key de OpenWeatherMap&#10;    // Obtén una gratis en: https://openweathermap.org/api&#10;    private val apiKey = &quot;2e67bf6a615df96c15c9e1533cc73189&quot;&#10;&#10;    suspend fun getCurrentWeather(lat: Double, lon: Double): Result&lt;WeatherResponse&gt; {&#10;        return try {&#10;            val response = apiService.getCurrentWeather(lat, lon, apiKey)&#10;            Result.success(response)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    suspend fun getCurrentWeatherByCity(city: String): Result&lt;WeatherResponse&gt; {&#10;        return try {&#10;            val response = apiService.getCurrentWeatherByCity(city, apiKey)&#10;            Result.success(response)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    suspend fun getForecast(lat: Double, lon: Double): Result&lt;ForecastResponse&gt; {&#10;        return try {&#10;            val response = apiService.getForecast(lat, lon, apiKey)&#10;            Result.success(response)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    suspend fun getAirQuality(lat: Double, lon: Double): Result&lt;AirQualityResponse&gt; {&#10;        return try {&#10;            val response = apiService.getAirQuality(lat, lon, apiKey)&#10;            Result.success(response)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.clima.data.repository&#10;&#10;import com.example.clima.data.api.CitySearchResult&#10;import com.example.clima.data.api.RetrofitClient&#10;import com.example.clima.data.models.AirQualityResponse&#10;import com.example.clima.data.models.ForecastResponse&#10;import com.example.clima.data.models.WeatherResponse&#10;&#10;class WeatherRepository {&#10;&#10;    private val apiService = RetrofitClient.weatherApiService&#10;    private val geocodingService = RetrofitClient.geocodingApiService&#10;&#10;    // Nota: Reemplaza esta API key con tu propia key de OpenWeatherMap&#10;    // Obtén una gratis en: https://openweathermap.org/api&#10;    private val apiKey = &quot;2e67bf6a615df96c15c9e1533cc73189&quot;&#10;&#10;    suspend fun getCurrentWeather(lat: Double, lon: Double): Result&lt;WeatherResponse&gt; {&#10;        return try {&#10;            val response = apiService.getCurrentWeather(lat, lon, apiKey)&#10;            Result.success(response)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    suspend fun getCurrentWeatherByCity(city: String): Result&lt;WeatherResponse&gt; {&#10;        return try {&#10;            val response = apiService.getCurrentWeatherByCity(city, apiKey)&#10;            Result.success(response)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    suspend fun getForecast(lat: Double, lon: Double): Result&lt;ForecastResponse&gt; {&#10;        return try {&#10;            val response = apiService.getForecast(lat, lon, apiKey)&#10;            Result.success(response)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    suspend fun getAirQuality(lat: Double, lon: Double): Result&lt;AirQualityResponse&gt; {&#10;        return try {&#10;            val response = apiService.getAirQuality(lat, lon, apiKey)&#10;            Result.success(response)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    suspend fun searchCities(query: String): Result&lt;List&lt;CitySearchResult&gt;&gt; {&#10;        return try {&#10;            if (query.length &lt; 2) {&#10;                return Result.success(emptyList())&#10;            }&#10;            val response = geocodingService.searchCities(query, 5, apiKey)&#10;            Result.success(response)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    // Nuevo método para obtener el nombre de la ciudad desde coordenadas&#10;    suspend fun getCityNameFromCoordinates(lat: Double, lon: Double): Result&lt;String&gt; {&#10;        return try {&#10;            val response = geocodingService.reverseCitySearch(lat, lon, 1, apiKey)&#10;            if (response.isNotEmpty()) {&#10;                val city = response.first()&#10;                // Retornar el nombre de la ciudad con el país&#10;                Result.success(&quot;${city.name}, ${city.country}&quot;)&#10;            } else {&#10;                Result.success(&quot;Ubicación desconocida&quot;)&#10;            }&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/clima/ui/screens/ImprovedWeatherScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/clima/ui/screens/ImprovedWeatherScreen.kt" />
              <option name="originalContent" value="package com.example.clima.ui.screens&#10;&#10;import androidx.compose.animation.*&#10;import androidx.compose.animation.core.*&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.LazyRow&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.alpha&#10;import androidx.compose.ui.draw.blur&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.draw.scale&#10;import androidx.compose.ui.graphics.Brush&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.clima.data.api.CitySearchResult&#10;import com.example.clima.data.models.*&#10;import com.example.clima.viewmodel.WeatherUiState&#10;import java.text.SimpleDateFormat&#10;import java.util.*&#10;import kotlin.math.roundToInt&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun ImprovedWeatherScreen(&#10;    uiState: WeatherUiState,&#10;    searchQuery: String,&#10;    citySuggestions: List&lt;CitySearchResult&gt;,&#10;    isSearching: Boolean,&#10;    onSearchQueryChange: (String) -&gt; Unit,&#10;    onSelectCity: (CitySearchResult) -&gt; Unit,&#10;    onClearSuggestions: () -&gt; Unit,&#10;    onRetry: () -&gt; Unit,&#10;    onRefresh: () -&gt; Unit = {},&#10;    onRequestLocationRefresh: () -&gt; Unit = {}&#10;) {&#10;    var showSearchDialog by remember { mutableStateOf(false) }&#10;    var isRefreshing by remember { mutableStateOf(false) }&#10;&#10;    LaunchedEffect(uiState) {&#10;        if (uiState !is WeatherUiState.Loading) {&#10;            isRefreshing = false&#10;        }&#10;    }&#10;&#10;    Box(modifier = Modifier.fillMaxSize()) {&#10;        when (uiState) {&#10;            is WeatherUiState.Loading -&gt; {&#10;                LoadingScreen()&#10;            }&#10;            is WeatherUiState.Error -&gt; {&#10;                ModernErrorScreen(&#10;                    message = uiState.message,&#10;                    onRetry = onRetry&#10;                )&#10;            }&#10;            is WeatherUiState.Success -&gt; {&#10;                ModernWeatherContent(&#10;                    weather = uiState.currentWeather,&#10;                    forecast = uiState.forecast,&#10;                    airQuality = uiState.airQuality,&#10;                    lastUpdated = uiState.lastUpdated,&#10;                    onSearchClick = { showSearchDialog = true },&#10;                    onLocationClick = onRequestLocationRefresh,&#10;                    onRefresh = {&#10;                        isRefreshing = true&#10;                        onRefresh()&#10;                    },&#10;                    isRefreshing = isRefreshing&#10;                )&#10;            }&#10;        }&#10;&#10;        // Diálogo de búsqueda con sugerencias&#10;        if (showSearchDialog) {&#10;            ModernSearchDialog(&#10;                query = searchQuery,&#10;                suggestions = citySuggestions,&#10;                isSearching = isSearching,&#10;                onQueryChange = onSearchQueryChange,&#10;                onSelectCity = { city -&gt;&#10;                    onSelectCity(city)&#10;                    showSearchDialog = false&#10;                },&#10;                onDismiss = {&#10;                    showSearchDialog = false&#10;                    onClearSuggestions()&#10;                }&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun LoadingScreen() {&#10;    val infiniteTransition = rememberInfiniteTransition(label = &quot;loading&quot;)&#10;    val scale by infiniteTransition.animateFloat(&#10;        initialValue = 0.8f,&#10;        targetValue = 1.2f,&#10;        animationSpec = infiniteRepeatable(&#10;            animation = tween(1000, easing = FastOutSlowInEasing),&#10;            repeatMode = RepeatMode.Reverse&#10;        ),&#10;        label = &quot;scale&quot;&#10;    )&#10;&#10;    Box(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(&#10;                Brush.verticalGradient(&#10;                    colors = listOf(Color(0xFF4A90E2), Color(0xFF50C9FF))&#10;                )&#10;            ),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Column(&#10;            horizontalAlignment = Alignment.CenterHorizontally,&#10;            verticalArrangement = Arrangement.Center&#10;        ) {&#10;            Text(&#10;                text = &quot;☀️&quot;,&#10;                fontSize = 80.sp,&#10;                modifier = Modifier.scale(scale)&#10;            )&#10;            Spacer(modifier = Modifier.height(24.dp))&#10;            CircularProgressIndicator(&#10;                color = Color.White,&#10;                strokeWidth = 3.dp&#10;            )&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;            Text(&#10;                text = &quot;Obteniendo datos del clima...&quot;,&#10;                color = Color.White,&#10;                style = MaterialTheme.typography.titleMedium,&#10;                fontWeight = FontWeight.Medium&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernErrorScreen(&#10;    message: String,&#10;    onRetry: () -&gt; Unit&#10;) {&#10;    Box(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(&#10;                Brush.verticalGradient(&#10;                    colors = listOf(Color(0xFF546E7A), Color(0xFF78909C))&#10;                )&#10;            ),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(32.dp),&#10;            colors = CardDefaults.cardColors(&#10;                containerColor = Color.White.copy(alpha = 0.95f)&#10;            ),&#10;            elevation = CardDefaults.cardElevation(8.dp)&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.padding(32.dp),&#10;                horizontalAlignment = Alignment.CenterHorizontally&#10;            ) {&#10;                Text(text = &quot;⚠️&quot;, fontSize = 64.sp)&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;                Text(&#10;                    text = &quot;Oops!&quot;,&#10;                    style = MaterialTheme.typography.headlineMedium,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;                Text(&#10;                    text = message,&#10;                    style = MaterialTheme.typography.bodyLarge,&#10;                    textAlign = TextAlign.Center,&#10;                    color = Color.Gray&#10;                )&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;                Button(&#10;                    onClick = onRetry,&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = Color(0xFF4A90E2)&#10;                    )&#10;                ) {&#10;                    Icon(Icons.Default.Refresh, contentDescription = null)&#10;                    Spacer(modifier = Modifier.width(8.dp))&#10;                    Text(&quot;Reintentar&quot;)&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun ModernWeatherContent(&#10;    weather: WeatherResponse,&#10;    forecast: ForecastResponse?,&#10;    airQuality: AirQualityResponse?,&#10;    lastUpdated: Long,&#10;    onSearchClick: () -&gt; Unit,&#10;    onLocationClick: () -&gt; Unit,&#10;    onRefresh: () -&gt; Unit,&#10;    isRefreshing: Boolean&#10;) {&#10;    val backgroundColor = getModernBackgroundGradient(weather.weather.firstOrNull()?.main ?: &quot;Clear&quot;)&#10;    val timeAgo = getTimeAgo(lastUpdated)&#10;&#10;    Box(modifier = Modifier.fillMaxSize()) {&#10;        LazyColumn(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .background(brush = backgroundColor)&#10;        ) {&#10;            // Header con botones&#10;            item {&#10;                ModernTopBar(&#10;                    onSearchClick = onSearchClick,&#10;                    onLocationClick = onLocationClick,&#10;                    timeAgo = timeAgo&#10;                )&#10;            }&#10;&#10;            // Temperatura principal con animación&#10;            item {&#10;                AnimatedTemperatureHeader(weather)&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;            }&#10;&#10;            // Pronóstico por horas con diseño moderno&#10;            item {&#10;                if (forecast != null) {&#10;                    ModernHourlyForecast(forecast)&#10;                    Spacer(modifier = Modifier.height(16.dp))&#10;                }&#10;            }&#10;&#10;            // Pronóstico de 5 días&#10;            item {&#10;                if (forecast != null) {&#10;                    ModernDailyForecast(forecast)&#10;                    Spacer(modifier = Modifier.height(16.dp))&#10;                }&#10;            }&#10;&#10;            // Grid de detalles con glassmorphism&#10;            item {&#10;                GlassmorphicDetailsGrid(weather)&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;            }&#10;&#10;            // Calidad del aire moderna&#10;            item {&#10;                if (airQuality != null) {&#10;                    ModernAirQualityCard(airQuality)&#10;                    Spacer(modifier = Modifier.height(16.dp))&#10;                }&#10;            }&#10;&#10;            // Sol con diseño atractivo&#10;            item {&#10;                ModernSunCard(weather.sys)&#10;                Spacer(modifier = Modifier.height(32.dp))&#10;            }&#10;        }&#10;&#10;        // Pull to refresh indicator&#10;        if (isRefreshing) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(top = 80.dp),&#10;                contentAlignment = Alignment.TopCenter&#10;            ) {&#10;                CircularProgressIndicator(&#10;                    color = Color.White,&#10;                    modifier = Modifier.size(32.dp)&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernTopBar(&#10;    onSearchClick: () -&gt; Unit,&#10;    onLocationClick: () -&gt; Unit,&#10;    timeAgo: String&#10;) {&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(16.dp),&#10;        horizontalArrangement = Arrangement.SpaceBetween,&#10;        verticalAlignment = Alignment.CenterVertically&#10;    ) {&#10;        Column {&#10;            Text(&#10;                text = &quot;Clima Actual&quot;,&#10;                style = MaterialTheme.typography.titleMedium,&#10;                color = Color.White,&#10;                fontWeight = FontWeight.Bold&#10;            )&#10;            Text(&#10;                text = timeAgo,&#10;                style = MaterialTheme.typography.bodySmall,&#10;                color = Color.White.copy(alpha = 0.7f)&#10;            )&#10;        }&#10;&#10;        Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            FloatingActionButton(&#10;                onClick = onSearchClick,&#10;                modifier = Modifier.size(48.dp),&#10;                containerColor = Color.White.copy(alpha = 0.3f),&#10;                elevation = FloatingActionButtonDefaults.elevation(0.dp)&#10;            ) {&#10;                Icon(&#10;                    Icons.Default.Search,&#10;                    contentDescription = &quot;Buscar&quot;,&#10;                    tint = Color.White&#10;                )&#10;            }&#10;&#10;            FloatingActionButton(&#10;                onClick = onLocationClick,&#10;                modifier = Modifier.size(48.dp),&#10;                containerColor = Color.White.copy(alpha = 0.3f),&#10;                elevation = FloatingActionButtonDefaults.elevation(0.dp)&#10;            ) {&#10;                Icon(&#10;                    Icons.Default.LocationOn,&#10;                    contentDescription = &quot;Mi ubicación&quot;,&#10;                    tint = Color.White&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun AnimatedTemperatureHeader(weather: WeatherResponse) {&#10;    var visible by remember { mutableStateOf(false) }&#10;&#10;    LaunchedEffect(Unit) {&#10;        visible = true&#10;    }&#10;&#10;    AnimatedVisibility(&#10;        visible = visible,&#10;        enter = fadeIn() + slideInVertically()&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(horizontal = 24.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            // Ubicación&#10;            Row(&#10;                verticalAlignment = Alignment.CenterVertically,&#10;                horizontalArrangement = Arrangement.Center&#10;            ) {&#10;                Icon(&#10;                    Icons.Default.LocationOn,&#10;                    contentDescription = null,&#10;                    tint = Color.White.copy(alpha = 0.9f),&#10;                    modifier = Modifier.size(20.dp)&#10;                )&#10;                Spacer(modifier = Modifier.width(4.dp))&#10;                Text(&#10;                    text = &quot;${weather.name}, ${weather.sys.country}&quot;,&#10;                    style = MaterialTheme.typography.headlineSmall,&#10;                    fontWeight = FontWeight.SemiBold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(24.dp))&#10;&#10;            // Icono del clima grande y animado&#10;            val scale by rememberInfiniteTransition(label = &quot;icon&quot;).animateFloat(&#10;                initialValue = 0.95f,&#10;                targetValue = 1.05f,&#10;                animationSpec = infiniteRepeatable(&#10;                    animation = tween(2000, easing = FastOutSlowInEasing),&#10;                    repeatMode = RepeatMode.Reverse&#10;                ),&#10;                label = &quot;scale&quot;&#10;            )&#10;&#10;            Text(&#10;                text = getWeatherIcon(weather.weather.firstOrNull()?.main ?: &quot;Clear&quot;),&#10;                fontSize = 140.sp,&#10;                modifier = Modifier.scale(scale)&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            // Temperatura con efecto de sombra&#10;            Box {&#10;                Text(&#10;                    text = &quot;${weather.main.temp.roundToInt()}°&quot;,&#10;                    fontSize = 96.sp,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White.copy(alpha = 0.3f),&#10;                    modifier = Modifier.offset(x = 4.dp, y = 4.dp)&#10;                )&#10;                Text(&#10;                    text = &quot;${weather.main.temp.roundToInt()}°&quot;,&#10;                    fontSize = 96.sp,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;&#10;            // Descripción&#10;            Text(&#10;                text = weather.weather.firstOrNull()?.description?.replaceFirstChar {&#10;                    if (it.isLowerCase()) it.titlecase(Locale.getDefault()) else it.toString()&#10;                } ?: &quot;&quot;,&#10;                style = MaterialTheme.typography.headlineMedium,&#10;                color = Color.White.copy(alpha = 0.95f),&#10;                fontWeight = FontWeight.Medium&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(12.dp))&#10;&#10;            // Min/Max en chip&#10;            Surface(&#10;                color = Color.White.copy(alpha = 0.25f),&#10;                shape = RoundedCornerShape(24.dp)&#10;            ) {&#10;                Row(&#10;                    modifier = Modifier.padding(horizontal = 20.dp, vertical = 10.dp),&#10;                    horizontalArrangement = Arrangement.spacedBy(16.dp)&#10;                ) {&#10;                    Row(verticalAlignment = Alignment.CenterVertically) {&#10;                        Text(text = &quot;↑&quot;, fontSize = 20.sp, color = Color.White)&#10;                        Spacer(modifier = Modifier.width(4.dp))&#10;                        Text(&#10;                            text = &quot;${weather.main.tempMax.roundToInt()}°&quot;,&#10;                            style = MaterialTheme.typography.titleMedium,&#10;                            color = Color.White,&#10;                            fontWeight = FontWeight.Bold&#10;                        )&#10;                    }&#10;                    Text(text = &quot;|&quot;, color = Color.White.copy(alpha = 0.5f))&#10;                    Row(verticalAlignment = Alignment.CenterVertically) {&#10;                        Text(text = &quot;↓&quot;, fontSize = 20.sp, color = Color.White)&#10;                        Spacer(modifier = Modifier.width(4.dp))&#10;                        Text(&#10;                            text = &quot;${weather.main.tempMin.roundToInt()}°&quot;,&#10;                            style = MaterialTheme.typography.titleMedium,&#10;                            color = Color.White,&#10;                            fontWeight = FontWeight.Bold&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernHourlyForecast(forecast: ForecastResponse) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White.copy(alpha = 0.25f)&#10;        ),&#10;        shape = RoundedCornerShape(24.dp)&#10;    ) {&#10;        Column(modifier = Modifier.padding(20.dp)) {&#10;            Row(verticalAlignment = Alignment.CenterVertically) {&#10;                Icon(&#10;                    Icons.Default.AccessTime,&#10;                    contentDescription = null,&#10;                    tint = Color.White,&#10;                    modifier = Modifier.size(24.dp)&#10;                )&#10;                Spacer(modifier = Modifier.width(12.dp))&#10;                Text(&#10;                    text = &quot;Pronóstico por Horas&quot;,&#10;                    style = MaterialTheme.typography.titleLarge,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            LazyRow(&#10;                horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;            ) {&#10;                items(forecast.list.take(12)) { item -&gt;&#10;                    ModernHourlyItem(item)&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernHourlyItem(item: ForecastItem) {&#10;    val time = SimpleDateFormat(&quot;HH:mm&quot;, Locale.getDefault())&#10;        .format(Date(item.dt * 1000))&#10;    val isNow = abs(System.currentTimeMillis() - item.dt * 1000) &lt; 3 * 60 * 60 * 1000&#10;&#10;    Surface(&#10;        color = if (isNow) Color.White.copy(alpha = 0.35f) else Color.White.copy(alpha = 0.2f),&#10;        shape = RoundedCornerShape(16.dp),&#10;        modifier = Modifier.width(80.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(16.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = if (isNow) &quot;Ahora&quot; else time,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                color = Color.White,&#10;                fontWeight = if (isNow) FontWeight.Bold else FontWeight.Normal&#10;            )&#10;            Spacer(modifier = Modifier.height(12.dp))&#10;            Text(&#10;                text = getWeatherIcon(item.weather.firstOrNull()?.main ?: &quot;Clear&quot;),&#10;                fontSize = 36.sp&#10;            )&#10;            Spacer(modifier = Modifier.height(12.dp))&#10;            Text(&#10;                text = &quot;${item.main.temp.roundToInt()}°&quot;,&#10;                style = MaterialTheme.typography.titleLarge,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.White&#10;            )&#10;            if (item.pop &gt; 0.1) {&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Text(text = &quot;&quot;, fontSize = 14.sp)&#10;                    Spacer(modifier = Modifier.width(2.dp))&#10;                    Text(&#10;                        text = &quot;${(item.pop * 100).roundToInt()}%&quot;,&#10;                        style = MaterialTheme.typography.bodySmall,&#10;                        color = Color(0xFF64B5F6),&#10;                        fontWeight = FontWeight.Bold&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernDailyForecast(forecast: ForecastResponse) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White.copy(alpha = 0.25f)&#10;        ),&#10;        shape = RoundedCornerShape(24.dp)&#10;    ) {&#10;        Column(modifier = Modifier.padding(20.dp)) {&#10;            Row(verticalAlignment = Alignment.CenterVertically) {&#10;                Icon(&#10;                    Icons.Default.CalendarToday,&#10;                    contentDescription = null,&#10;                    tint = Color.White,&#10;                    modifier = Modifier.size(24.dp)&#10;                )&#10;                Spacer(modifier = Modifier.width(12.dp))&#10;                Text(&#10;                    text = &quot;Próximos 5 Días&quot;,&#10;                    style = MaterialTheme.typography.titleLarge,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            val dailyForecasts = forecast.list.groupBy { item -&gt;&#10;                SimpleDateFormat(&quot;yyyy-MM-dd&quot;, Locale.getDefault())&#10;                    .format(Date(item.dt * 1000))&#10;            }.values.take(5)&#10;&#10;            dailyForecasts.forEachIndexed { index, dayItems -&gt;&#10;                ModernDailyItem(dayItems, index == 0)&#10;                if (index &lt; dailyForecasts.size - 1) {&#10;                    HorizontalDivider(&#10;                        color = Color.White.copy(alpha = 0.2f),&#10;                        modifier = Modifier.padding(vertical = 12.dp)&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernDailyItem(dayItems: List&lt;ForecastItem&gt;, isToday: Boolean) {&#10;    val date = Date(dayItems.first().dt * 1000)&#10;    val dayName = if (isToday) &quot;Hoy&quot; else SimpleDateFormat(&quot;EEEE&quot;, Locale.getDefault()).format(date)&#10;    val maxTemp = dayItems.maxOf { it.main.tempMax }&#10;    val minTemp = dayItems.minOf { it.main.tempMin }&#10;    val mainWeather = dayItems[dayItems.size / 2].weather.firstOrNull()?.main ?: &quot;Clear&quot;&#10;    val maxPop = dayItems.maxOf { it.pop }&#10;&#10;    Row(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        verticalAlignment = Alignment.CenterVertically,&#10;        horizontalArrangement = Arrangement.SpaceBetween&#10;    ) {&#10;        Text(&#10;            text = dayName.replaceFirstChar {&#10;                if (it.isLowerCase()) it.titlecase() else it.toString()&#10;            },&#10;            style = MaterialTheme.typography.titleMedium,&#10;            color = Color.White,&#10;            fontWeight = if (isToday) FontWeight.Bold else FontWeight.Medium,&#10;            modifier = Modifier.weight(1f)&#10;        )&#10;&#10;        if (maxPop &gt; 0.1) {&#10;            Row(&#10;                verticalAlignment = Alignment.CenterVertically,&#10;                modifier = Modifier.padding(end = 16.dp)&#10;            ) {&#10;                Text(text = &quot;&quot;, fontSize = 18.sp)&#10;                Spacer(modifier = Modifier.width(4.dp))&#10;                Text(&#10;                    text = &quot;${(maxPop * 100).roundToInt()}%&quot;,&#10;                    style = MaterialTheme.typography.bodyMedium,&#10;                    color = Color(0xFF64B5F6),&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;            }&#10;        }&#10;&#10;        Text(&#10;            text = getWeatherIcon(mainWeather),&#10;            fontSize = 32.sp,&#10;            modifier = Modifier.padding(horizontal = 16.dp)&#10;        )&#10;&#10;        Column(horizontalAlignment = Alignment.End) {&#10;            Text(&#10;                text = &quot;${maxTemp.roundToInt()}°&quot;,&#10;                style = MaterialTheme.typography.titleMedium,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.White&#10;            )&#10;            Text(&#10;                text = &quot;${minTemp.roundToInt()}°&quot;,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                color = Color.White.copy(alpha = 0.7f)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun GlassmorphicDetailsGrid(weather: WeatherResponse) {&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(12.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            GlassDetailCard(&#10;                icon = &quot;️&quot;,&#10;                label = &quot;Sensación Térmica&quot;,&#10;                value = &quot;${weather.main.feelsLike.roundToInt()}°&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;            GlassDetailCard(&#10;                icon = &quot;&quot;,&#10;                label = &quot;Humedad&quot;,&#10;                value = &quot;${weather.main.humidity}%&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;        }&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            GlassDetailCard(&#10;                icon = &quot;&quot;,&#10;                label = &quot;Viento&quot;,&#10;                value = &quot;${weather.wind.speed} m/s&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;            GlassDetailCard(&#10;                icon = &quot;️&quot;,&#10;                label = &quot;Visibilidad&quot;,&#10;                value = &quot;${weather.visibility / 1000} km&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;        }&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            GlassDetailCard(&#10;                icon = &quot;&quot;,&#10;                label = &quot;Presión&quot;,&#10;                value = &quot;${weather.main.pressure} hPa&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;            GlassDetailCard(&#10;                icon = &quot;☁️&quot;,&#10;                label = &quot;Nubosidad&quot;,&#10;                value = &quot;${weather.clouds.all}%&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun GlassDetailCard(&#10;    icon: String,&#10;    label: String,&#10;    value: String,&#10;    modifier: Modifier = Modifier&#10;) {&#10;    Card(&#10;        modifier = modifier,&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White.copy(alpha = 0.25f)&#10;        ),&#10;        shape = RoundedCornerShape(20.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(20.dp),&#10;            horizontalAlignment = Alignment.Start&#10;        ) {&#10;            Text(text = icon, fontSize = 32.sp)&#10;            Spacer(modifier = Modifier.height(12.dp))&#10;            Text(&#10;                text = label,&#10;                style = MaterialTheme.typography.bodySmall,&#10;                color = Color.White.copy(alpha = 0.8f),&#10;                fontWeight = FontWeight.Medium&#10;            )&#10;            Spacer(modifier = Modifier.height(4.dp))&#10;            Text(&#10;                text = value,&#10;                style = MaterialTheme.typography.headlineSmall,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.White&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernAirQualityCard(airQuality: AirQualityResponse) {&#10;    val aqi = airQuality.list.firstOrNull()?.main?.aqi ?: 1&#10;    val (aqiText, aqiColor) = getAirQualityInfo(aqi)&#10;&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White.copy(alpha = 0.25f)&#10;        ),&#10;        shape = RoundedCornerShape(24.dp)&#10;    ) {&#10;        Column(modifier = Modifier.padding(20.dp)) {&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Text(text = &quot;️&quot;, fontSize = 32.sp)&#10;                    Spacer(modifier = Modifier.width(12.dp))&#10;                    Column {&#10;                        Text(&#10;                            text = &quot;Calidad del Aire&quot;,&#10;                            style = MaterialTheme.typography.titleLarge,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = Color.White&#10;                        )&#10;                        Text(&#10;                            text = &quot;AQI Index&quot;,&#10;                            style = MaterialTheme.typography.bodySmall,&#10;                            color = Color.White.copy(alpha = 0.7f)&#10;                        )&#10;                    }&#10;                }&#10;&#10;                Surface(&#10;                    color = aqiColor,&#10;                    shape = RoundedCornerShape(16.dp)&#10;                ) {&#10;                    Text(&#10;                        text = aqiText,&#10;                        modifier = Modifier.padding(horizontal = 16.dp, vertical = 8.dp),&#10;                        style = MaterialTheme.typography.titleMedium,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = Color.White&#10;                    )&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(20.dp))&#10;&#10;            val components = airQuality.list.firstOrNull()?.components&#10;            if (components != null) {&#10;                Row(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;                ) {&#10;                    AirComponentBox(&quot;PM2.5&quot;, components.pm2_5.roundToInt().toString(), Modifier.weight(1f))&#10;                    AirComponentBox(&quot;PM10&quot;, components.pm10.roundToInt().toString(), Modifier.weight(1f))&#10;                    AirComponentBox(&quot;O₃&quot;, components.o3.roundToInt().toString(), Modifier.weight(1f))&#10;                    AirComponentBox(&quot;NO₂&quot;, components.no2.roundToInt().toString(), Modifier.weight(1f))&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun AirComponentBox(label: String, value: String, modifier: Modifier = Modifier) {&#10;    Surface(&#10;        modifier = modifier,&#10;        color = Color.White.copy(alpha = 0.2f),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(12.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = label,&#10;                style = MaterialTheme.typography.bodySmall,&#10;                color = Color.White.copy(alpha = 0.8f),&#10;                fontWeight = FontWeight.Medium&#10;            )&#10;            Spacer(modifier = Modifier.height(4.dp))&#10;            Text(&#10;                text = value,&#10;                style = MaterialTheme.typography.titleMedium,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.White&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernSunCard(sys: Sys) {&#10;    val sunrise = SimpleDateFormat(&quot;HH:mm&quot;, Locale.getDefault()).format(Date(sys.sunrise * 1000))&#10;    val sunset = SimpleDateFormat(&quot;HH:mm&quot;, Locale.getDefault()).format(Date(sys.sunset * 1000))&#10;&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White.copy(alpha = 0.25f)&#10;        ),&#10;        shape = RoundedCornerShape(24.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(24.dp),&#10;            horizontalArrangement = Arrangement.SpaceEvenly&#10;        ) {&#10;            Column(&#10;                horizontalAlignment = Alignment.CenterHorizontally,&#10;                modifier = Modifier.weight(1f)&#10;            ) {&#10;                Surface(&#10;                    color = Color(0xFFFFA726).copy(alpha = 0.3f),&#10;                    shape = CircleShape,&#10;                    modifier = Modifier.size(64.dp)&#10;                ) {&#10;                    Box(contentAlignment = Alignment.Center) {&#10;                        Text(text = &quot;&quot;, fontSize = 32.sp)&#10;                    }&#10;                }&#10;                Spacer(modifier = Modifier.height(12.dp))&#10;                Text(&#10;                    text = &quot;Amanecer&quot;,&#10;                    style = MaterialTheme.typography.bodyMedium,&#10;                    color = Color.White.copy(alpha = 0.8f)&#10;                )&#10;                Text(&#10;                    text = sunrise,&#10;                    style = MaterialTheme.typography.headlineSmall,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;&#10;            HorizontalDivider(&#10;                color = Color.White.copy(alpha = 0.3f),&#10;                modifier = Modifier&#10;                    .height(100.dp)&#10;                    .width(1.dp)&#10;            )&#10;&#10;            Column(&#10;                horizontalAlignment = Alignment.CenterHorizontally,&#10;                modifier = Modifier.weight(1f)&#10;            ) {&#10;                Surface(&#10;                    color = Color(0xFFFF7043).copy(alpha = 0.3f),&#10;                    shape = CircleShape,&#10;                    modifier = Modifier.size(64.dp)&#10;                ) {&#10;                    Box(contentAlignment = Alignment.Center) {&#10;                        Text(text = &quot;&quot;, fontSize = 32.sp)&#10;                    }&#10;                }&#10;                Spacer(modifier = Modifier.height(12.dp))&#10;                Text(&#10;                    text = &quot;Atardecer&quot;,&#10;                    style = MaterialTheme.typography.bodyMedium,&#10;                    color = Color.White.copy(alpha = 0.8f)&#10;                )&#10;                Text(&#10;                    text = sunset,&#10;                    style = MaterialTheme.typography.headlineSmall,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun ModernSearchDialog(&#10;    query: String,&#10;    suggestions: List&lt;CitySearchResult&gt;,&#10;    isSearching: Boolean,&#10;    onQueryChange: (String) -&gt; Unit,&#10;    onSelectCity: (CitySearchResult) -&gt; Unit,&#10;    onDismiss: () -&gt; Unit&#10;) {&#10;    AlertDialog(&#10;        onDismissRequest = onDismiss,&#10;        containerColor = Color.White,&#10;        shape = RoundedCornerShape(28.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(24.dp)&#10;        ) {&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Text(&#10;                    text = &quot;Buscar Ciudad&quot;,&#10;                    style = MaterialTheme.typography.headlineSmall,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;                IconButton(onClick = onDismiss) {&#10;                    Icon(Icons.Default.Close, contentDescription = &quot;Cerrar&quot;)&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            OutlinedTextField(&#10;                value = query,&#10;                onValueChange = onQueryChange,&#10;                modifier = Modifier.fillMaxWidth(),&#10;                placeholder = { Text(&quot;Escribe el nombre de la ciudad...&quot;) },&#10;                leadingIcon = { Icon(Icons.Default.Search, contentDescription = null) },&#10;                trailingIcon = {&#10;                    if (isSearching) {&#10;                        CircularProgressIndicator(modifier = Modifier.size(24.dp), strokeWidth = 2.dp)&#10;                    } else if (query.isNotEmpty()) {&#10;                        IconButton(onClick = { onQueryChange(&quot;&quot;) }) {&#10;                            Icon(Icons.Default.Clear, contentDescription = &quot;Limpiar&quot;)&#10;                        }&#10;                    }&#10;                },&#10;                singleLine = true,&#10;                shape = RoundedCornerShape(16.dp),&#10;                colors = OutlinedTextFieldDefaults.colors(&#10;                    focusedBorderColor = Color(0xFF4A90E2),&#10;                    unfocusedBorderColor = Color.Gray.copy(alpha = 0.3f)&#10;                )&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            // Sugerencias&#10;            if (suggestions.isNotEmpty()) {&#10;                Text(&#10;                    text = &quot;Sugerencias:&quot;,&#10;                    style = MaterialTheme.typography.titleSmall,&#10;                    fontWeight = FontWeight.SemiBold,&#10;                    color = Color.Gray&#10;                )&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;&#10;                LazyColumn(&#10;                    modifier = Modifier.heightIn(max = 300.dp),&#10;                    verticalArrangement = Arrangement.spacedBy(4.dp)&#10;                ) {&#10;                    items(suggestions) { city -&gt;&#10;                        SuggestionItem(city, onSelectCity)&#10;                    }&#10;                }&#10;            } else if (query.length &gt;= 2 &amp;&amp; !isSearching) {&#10;                Box(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(32.dp),&#10;                    contentAlignment = Alignment.Center&#10;                ) {&#10;                    Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;                        Text(text = &quot;&quot;, fontSize = 48.sp)&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                        Text(&#10;                            text = &quot;No se encontraron ciudades&quot;,&#10;                            style = MaterialTheme.typography.bodyMedium,&#10;                            color = Color.Gray&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun SuggestionItem(&#10;    city: CitySearchResult,&#10;    onSelect: (CitySearchResult) -&gt; Unit&#10;) {&#10;    Surface(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .clickable { onSelect(city) },&#10;        color = Color.Gray.copy(alpha = 0.1f),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier.padding(16.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Surface(&#10;                color = Color(0xFF4A90E2).copy(alpha = 0.2f),&#10;                shape = CircleShape,&#10;                modifier = Modifier.size(40.dp)&#10;            ) {&#10;                Box(contentAlignment = Alignment.Center) {&#10;                    Icon(&#10;                        Icons.Default.LocationOn,&#10;                        contentDescription = null,&#10;                        tint = Color(0xFF4A90E2),&#10;                        modifier = Modifier.size(24.dp)&#10;                    )&#10;                }&#10;            }&#10;            Spacer(modifier = Modifier.width(12.dp))&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Text(&#10;                    text = city.name,&#10;                    style = MaterialTheme.typography.titleMedium,&#10;                    fontWeight = FontWeight.SemiBold&#10;                )&#10;                Text(&#10;                    text = buildString {&#10;                        city.state?.let { append(&quot;$it, &quot;) }&#10;                        append(city.country)&#10;                    },&#10;                    style = MaterialTheme.typography.bodySmall,&#10;                    color = Color.Gray&#10;                )&#10;            }&#10;            Icon(&#10;                Icons.Default.ChevronRight,&#10;                contentDescription = null,&#10;                tint = Color.Gray&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;// Funciones auxiliares&#10;fun getModernBackgroundGradient(condition: String): Brush {&#10;    return when (condition) {&#10;        &quot;Clear&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF4A90E2),&#10;                Color(0xFF50B5FF),&#10;                Color(0xFF63C5FF)&#10;            )&#10;        )&#10;        &quot;Clouds&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF546E7A),&#10;                Color(0xFF607D8B),&#10;                Color(0xFF78909C)&#10;            )&#10;        )&#10;        &quot;Rain&quot;, &quot;Drizzle&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF455A64),&#10;                Color(0xFF546E7A),&#10;                Color(0xFF607D8B)&#10;            )&#10;        )&#10;        &quot;Thunderstorm&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF263238),&#10;                Color(0xFF37474F),&#10;                Color(0xFF455A64)&#10;            )&#10;        )&#10;        &quot;Snow&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF90A4AE),&#10;                Color(0xFFB0BEC5),&#10;                Color(0xFFCFD8DC)&#10;            )&#10;        )&#10;        &quot;Mist&quot;, &quot;Fog&quot;, &quot;Haze&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF78909C),&#10;                Color(0xFF90A4AE),&#10;                Color(0xFFB0BEC5)&#10;            )&#10;        )&#10;        else -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF4A90E2),&#10;                Color(0xFF50B5FF),&#10;                Color(0xFF63C5FF)&#10;            )&#10;        )&#10;    }&#10;}&#10;&#10;fun getTimeAgo(timestamp: Long): String {&#10;    val diff = System.currentTimeMillis() - timestamp&#10;    val minutes = diff / (60 * 1000)&#10;    return when {&#10;        minutes &lt; 1 -&gt; &quot;Actualizado ahora&quot;&#10;        minutes &lt; 60 -&gt; &quot;Actualizado hace $minutes min&quot;&#10;        else -&gt; {&#10;            val hours = minutes / 60&#10;            &quot;Actualizado hace $hours h&quot;&#10;        }&#10;    }&#10;}&#10;&#10;private fun abs(l: Long): Long = if (l &lt; 0) -l else l&#10;" />
              <option name="updatedContent" value="package com.example.clima.ui.screens&#10;&#10;import androidx.compose.animation.*&#10;import androidx.compose.animation.core.*&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.LazyRow&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.scale&#10;import androidx.compose.ui.graphics.Brush&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.compose.ui.window.Dialog&#10;import com.example.clima.data.api.CitySearchResult&#10;import com.example.clima.data.models.*&#10;import com.example.clima.viewmodel.WeatherUiState&#10;import java.text.SimpleDateFormat&#10;import java.util.*&#10;import kotlin.math.roundToInt&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun ImprovedWeatherScreen(&#10;    uiState: WeatherUiState,&#10;    searchQuery: String,&#10;    citySuggestions: List&lt;CitySearchResult&gt;,&#10;    isSearching: Boolean,&#10;    onSearchQueryChange: (String) -&gt; Unit,&#10;    onSelectCity: (CitySearchResult) -&gt; Unit,&#10;    onClearSuggestions: () -&gt; Unit,&#10;    onRetry: () -&gt; Unit,&#10;    onRefresh: () -&gt; Unit = {},&#10;    onRequestLocationRefresh: () -&gt; Unit = {}&#10;) {&#10;    var showSearchDialog by remember { mutableStateOf(false) }&#10;    var isRefreshing by remember { mutableStateOf(false) }&#10;&#10;    LaunchedEffect(uiState) {&#10;        if (uiState !is WeatherUiState.Loading) {&#10;            isRefreshing = false&#10;        }&#10;    }&#10;&#10;    Box(modifier = Modifier.fillMaxSize()) {&#10;        when (uiState) {&#10;            is WeatherUiState.Loading -&gt; {&#10;                LoadingScreen()&#10;            }&#10;            is WeatherUiState.Error -&gt; {&#10;                ModernErrorScreen(&#10;                    message = uiState.message,&#10;                    onRetry = onRetry&#10;                )&#10;            }&#10;            is WeatherUiState.Success -&gt; {&#10;                ModernWeatherContent(&#10;                    weather = uiState.currentWeather,&#10;                    forecast = uiState.forecast,&#10;                    airQuality = uiState.airQuality,&#10;                    lastUpdated = uiState.lastUpdated,&#10;                    onSearchClick = { showSearchDialog = true },&#10;                    onLocationClick = onRequestLocationRefresh,&#10;                    onRefresh = {&#10;                        isRefreshing = true&#10;                        onRefresh()&#10;                    },&#10;                    isRefreshing = isRefreshing&#10;                )&#10;            }&#10;        }&#10;&#10;        // Diálogo de búsqueda con sugerencias&#10;        if (showSearchDialog) {&#10;            ModernSearchDialog(&#10;                query = searchQuery,&#10;                suggestions = citySuggestions,&#10;                isSearching = isSearching,&#10;                onQueryChange = onSearchQueryChange,&#10;                onSelectCity = { city -&gt;&#10;                    onSelectCity(city)&#10;                    showSearchDialog = false&#10;                },&#10;                onDismiss = {&#10;                    showSearchDialog = false&#10;                    onClearSuggestions()&#10;                }&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun LoadingScreen() {&#10;    val infiniteTransition = rememberInfiniteTransition(label = &quot;loading&quot;)&#10;    val scale by infiniteTransition.animateFloat(&#10;        initialValue = 0.8f,&#10;        targetValue = 1.2f,&#10;        animationSpec = infiniteRepeatable(&#10;            animation = tween(1000, easing = FastOutSlowInEasing),&#10;            repeatMode = RepeatMode.Reverse&#10;        ),&#10;        label = &quot;scale&quot;&#10;    )&#10;&#10;    Box(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(&#10;                Brush.verticalGradient(&#10;                    colors = listOf(Color(0xFF4A90E2), Color(0xFF50C9FF))&#10;                )&#10;            ),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Column(&#10;            horizontalAlignment = Alignment.CenterHorizontally,&#10;            verticalArrangement = Arrangement.Center&#10;        ) {&#10;            Text(&#10;                text = &quot;☀️&quot;,&#10;                fontSize = 80.sp,&#10;                modifier = Modifier.scale(scale)&#10;            )&#10;            Spacer(modifier = Modifier.height(24.dp))&#10;            CircularProgressIndicator(&#10;                color = Color.White,&#10;                strokeWidth = 3.dp&#10;            )&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;            Text(&#10;                text = &quot;Obteniendo datos del clima...&quot;,&#10;                color = Color.White,&#10;                style = MaterialTheme.typography.titleMedium,&#10;                fontWeight = FontWeight.Medium&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernErrorScreen(&#10;    message: String,&#10;    onRetry: () -&gt; Unit&#10;) {&#10;    Box(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(&#10;                Brush.verticalGradient(&#10;                    colors = listOf(Color(0xFF546E7A), Color(0xFF78909C))&#10;                )&#10;            ),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(32.dp),&#10;            colors = CardDefaults.cardColors(&#10;                containerColor = Color.White.copy(alpha = 0.95f)&#10;            ),&#10;            elevation = CardDefaults.cardElevation(8.dp)&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.padding(32.dp),&#10;                horizontalAlignment = Alignment.CenterHorizontally&#10;            ) {&#10;                Text(text = &quot;⚠️&quot;, fontSize = 64.sp)&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;                Text(&#10;                    text = &quot;Oops!&quot;,&#10;                    style = MaterialTheme.typography.headlineMedium,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;                Text(&#10;                    text = message,&#10;                    style = MaterialTheme.typography.bodyLarge,&#10;                    textAlign = TextAlign.Center,&#10;                    color = Color.Gray&#10;                )&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;                Button(&#10;                    onClick = onRetry,&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = Color(0xFF4A90E2)&#10;                    )&#10;                ) {&#10;                    Icon(Icons.Default.Refresh, contentDescription = null)&#10;                    Spacer(modifier = Modifier.width(8.dp))&#10;                    Text(&quot;Reintentar&quot;)&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun ModernWeatherContent(&#10;    weather: WeatherResponse,&#10;    forecast: ForecastResponse?,&#10;    airQuality: AirQualityResponse?,&#10;    lastUpdated: Long,&#10;    onSearchClick: () -&gt; Unit,&#10;    onLocationClick: () -&gt; Unit,&#10;    onRefresh: () -&gt; Unit,&#10;    isRefreshing: Boolean&#10;) {&#10;    val backgroundColor = getModernBackgroundGradient(weather.weather.firstOrNull()?.main ?: &quot;Clear&quot;)&#10;    val timeAgo = getTimeAgo(lastUpdated)&#10;&#10;    Box(modifier = Modifier.fillMaxSize()) {&#10;        LazyColumn(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .background(brush = backgroundColor)&#10;        ) {&#10;            // Header con botones&#10;            item {&#10;                ModernTopBar(&#10;                    onSearchClick = onSearchClick,&#10;                    onLocationClick = onLocationClick,&#10;                    timeAgo = timeAgo&#10;                )&#10;            }&#10;&#10;            // Temperatura principal con animación&#10;            item {&#10;                AnimatedTemperatureHeader(weather)&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;            }&#10;&#10;            // Pronóstico por horas con diseño moderno&#10;            item {&#10;                if (forecast != null) {&#10;                    ModernHourlyForecast(forecast)&#10;                    Spacer(modifier = Modifier.height(16.dp))&#10;                }&#10;            }&#10;&#10;            // Pronóstico de 5 días&#10;            item {&#10;                if (forecast != null) {&#10;                    ModernDailyForecast(forecast)&#10;                    Spacer(modifier = Modifier.height(16.dp))&#10;                }&#10;            }&#10;&#10;            // Grid de detalles con glassmorphism&#10;            item {&#10;                GlassmorphicDetailsGrid(weather)&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;            }&#10;&#10;            // Calidad del aire moderna&#10;            item {&#10;                if (airQuality != null) {&#10;                    ModernAirQualityCard(airQuality)&#10;                    Spacer(modifier = Modifier.height(16.dp))&#10;                }&#10;            }&#10;&#10;            // Sol con diseño atractivo&#10;            item {&#10;                ModernSunCard(weather.sys)&#10;                Spacer(modifier = Modifier.height(32.dp))&#10;            }&#10;        }&#10;&#10;        // Pull to refresh indicator&#10;        if (isRefreshing) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(top = 80.dp),&#10;                contentAlignment = Alignment.TopCenter&#10;            ) {&#10;                CircularProgressIndicator(&#10;                    color = Color.White,&#10;                    modifier = Modifier.size(32.dp)&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernTopBar(&#10;    onSearchClick: () -&gt; Unit,&#10;    onLocationClick: () -&gt; Unit,&#10;    timeAgo: String&#10;) {&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(16.dp),&#10;        horizontalArrangement = Arrangement.SpaceBetween,&#10;        verticalAlignment = Alignment.CenterVertically&#10;    ) {&#10;        Column {&#10;            Text(&#10;                text = &quot;Clima Actual&quot;,&#10;                style = MaterialTheme.typography.titleMedium,&#10;                color = Color.White,&#10;                fontWeight = FontWeight.Bold&#10;            )&#10;            Text(&#10;                text = timeAgo,&#10;                style = MaterialTheme.typography.bodySmall,&#10;                color = Color.White.copy(alpha = 0.7f)&#10;            )&#10;        }&#10;&#10;        Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            FloatingActionButton(&#10;                onClick = onSearchClick,&#10;                modifier = Modifier.size(48.dp),&#10;                containerColor = Color.White.copy(alpha = 0.3f),&#10;                elevation = FloatingActionButtonDefaults.elevation(0.dp)&#10;            ) {&#10;                Icon(&#10;                    Icons.Default.Search,&#10;                    contentDescription = &quot;Buscar&quot;,&#10;                    tint = Color.White&#10;                )&#10;            }&#10;&#10;            FloatingActionButton(&#10;                onClick = onLocationClick,&#10;                modifier = Modifier.size(48.dp),&#10;                containerColor = Color.White.copy(alpha = 0.3f),&#10;                elevation = FloatingActionButtonDefaults.elevation(0.dp)&#10;            ) {&#10;                Icon(&#10;                    Icons.Default.LocationOn,&#10;                    contentDescription = &quot;Mi ubicación&quot;,&#10;                    tint = Color.White&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun AnimatedTemperatureHeader(weather: WeatherResponse) {&#10;    var visible by remember { mutableStateOf(false) }&#10;&#10;    LaunchedEffect(Unit) {&#10;        visible = true&#10;    }&#10;&#10;    AnimatedVisibility(&#10;        visible = visible,&#10;        enter = fadeIn() + slideInVertically()&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(horizontal = 24.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            // Ubicación&#10;            Row(&#10;                verticalAlignment = Alignment.CenterVertically,&#10;                horizontalArrangement = Arrangement.Center&#10;            ) {&#10;                Icon(&#10;                    Icons.Default.LocationOn,&#10;                    contentDescription = null,&#10;                    tint = Color.White.copy(alpha = 0.9f),&#10;                    modifier = Modifier.size(20.dp)&#10;                )&#10;                Spacer(modifier = Modifier.width(4.dp))&#10;                Text(&#10;                    text = &quot;${weather.name}, ${weather.sys.country}&quot;,&#10;                    style = MaterialTheme.typography.headlineSmall,&#10;                    fontWeight = FontWeight.SemiBold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(24.dp))&#10;&#10;            // Icono del clima grande y animado&#10;            val scale by rememberInfiniteTransition(label = &quot;icon&quot;).animateFloat(&#10;                initialValue = 0.95f,&#10;                targetValue = 1.05f,&#10;                animationSpec = infiniteRepeatable(&#10;                    animation = tween(2000, easing = FastOutSlowInEasing),&#10;                    repeatMode = RepeatMode.Reverse&#10;                ),&#10;                label = &quot;scale&quot;&#10;            )&#10;&#10;            Text(&#10;                text = getWeatherIcon(weather.weather.firstOrNull()?.main ?: &quot;Clear&quot;),&#10;                fontSize = 140.sp,&#10;                modifier = Modifier.scale(scale)&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            // Temperatura con efecto de sombra&#10;            Box {&#10;                Text(&#10;                    text = &quot;${weather.main.temp.roundToInt()}°&quot;,&#10;                    fontSize = 96.sp,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White.copy(alpha = 0.3f),&#10;                    modifier = Modifier.offset(x = 4.dp, y = 4.dp)&#10;                )&#10;                Text(&#10;                    text = &quot;${weather.main.temp.roundToInt()}°&quot;,&#10;                    fontSize = 96.sp,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;&#10;            // Descripción&#10;            Text(&#10;                text = weather.weather.firstOrNull()?.description?.replaceFirstChar {&#10;                    if (it.isLowerCase()) it.titlecase(Locale.getDefault()) else it.toString()&#10;                } ?: &quot;&quot;,&#10;                style = MaterialTheme.typography.headlineMedium,&#10;                color = Color.White.copy(alpha = 0.95f),&#10;                fontWeight = FontWeight.Medium&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(12.dp))&#10;&#10;            // Min/Max en chip&#10;            Surface(&#10;                color = Color.White.copy(alpha = 0.25f),&#10;                shape = RoundedCornerShape(24.dp)&#10;            ) {&#10;                Row(&#10;                    modifier = Modifier.padding(horizontal = 20.dp, vertical = 10.dp),&#10;                    horizontalArrangement = Arrangement.spacedBy(16.dp)&#10;                ) {&#10;                    Row(verticalAlignment = Alignment.CenterVertically) {&#10;                        Text(text = &quot;↑&quot;, fontSize = 20.sp, color = Color.White)&#10;                        Spacer(modifier = Modifier.width(4.dp))&#10;                        Text(&#10;                            text = &quot;${weather.main.tempMax.roundToInt()}°&quot;,&#10;                            style = MaterialTheme.typography.titleMedium,&#10;                            color = Color.White,&#10;                            fontWeight = FontWeight.Bold&#10;                        )&#10;                    }&#10;                    Text(text = &quot;|&quot;, color = Color.White.copy(alpha = 0.5f))&#10;                    Row(verticalAlignment = Alignment.CenterVertically) {&#10;                        Text(text = &quot;↓&quot;, fontSize = 20.sp, color = Color.White)&#10;                        Spacer(modifier = Modifier.width(4.dp))&#10;                        Text(&#10;                            text = &quot;${weather.main.tempMin.roundToInt()}°&quot;,&#10;                            style = MaterialTheme.typography.titleMedium,&#10;                            color = Color.White,&#10;                            fontWeight = FontWeight.Bold&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernHourlyForecast(forecast: ForecastResponse) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White.copy(alpha = 0.25f)&#10;        ),&#10;        shape = RoundedCornerShape(24.dp)&#10;    ) {&#10;        Column(modifier = Modifier.padding(20.dp)) {&#10;            Row(verticalAlignment = Alignment.CenterVertically) {&#10;                Icon(&#10;                    Icons.Default.AccessTime,&#10;                    contentDescription = null,&#10;                    tint = Color.White,&#10;                    modifier = Modifier.size(24.dp)&#10;                )&#10;                Spacer(modifier = Modifier.width(12.dp))&#10;                Text(&#10;                    text = &quot;Pronóstico por Horas&quot;,&#10;                    style = MaterialTheme.typography.titleLarge,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            LazyRow(&#10;                horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;            ) {&#10;                items(forecast.list.take(12)) { item -&gt;&#10;                    ModernHourlyItem(item)&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernHourlyItem(item: ForecastItem) {&#10;    val time = SimpleDateFormat(&quot;HH:mm&quot;, Locale.getDefault())&#10;        .format(Date(item.dt * 1000))&#10;    val isNow = abs(System.currentTimeMillis() - item.dt * 1000) &lt; 3 * 60 * 60 * 1000&#10;&#10;    Surface(&#10;        color = if (isNow) Color.White.copy(alpha = 0.35f) else Color.White.copy(alpha = 0.2f),&#10;        shape = RoundedCornerShape(16.dp),&#10;        modifier = Modifier.width(80.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(16.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = if (isNow) &quot;Ahora&quot; else time,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                color = Color.White,&#10;                fontWeight = if (isNow) FontWeight.Bold else FontWeight.Normal&#10;            )&#10;            Spacer(modifier = Modifier.height(12.dp))&#10;            Text(&#10;                text = getWeatherIcon(item.weather.firstOrNull()?.main ?: &quot;Clear&quot;),&#10;                fontSize = 36.sp&#10;            )&#10;            Spacer(modifier = Modifier.height(12.dp))&#10;            Text(&#10;                text = &quot;${item.main.temp.roundToInt()}°&quot;,&#10;                style = MaterialTheme.typography.titleLarge,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.White&#10;            )&#10;            if (item.pop &gt; 0.1) {&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Text(text = &quot;&quot;, fontSize = 14.sp)&#10;                    Spacer(modifier = Modifier.width(2.dp))&#10;                    Text(&#10;                        text = &quot;${(item.pop * 100).roundToInt()}%&quot;,&#10;                        style = MaterialTheme.typography.bodySmall,&#10;                        color = Color(0xFF64B5F6),&#10;                        fontWeight = FontWeight.Bold&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernDailyForecast(forecast: ForecastResponse) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White.copy(alpha = 0.25f)&#10;        ),&#10;        shape = RoundedCornerShape(24.dp)&#10;    ) {&#10;        Column(modifier = Modifier.padding(20.dp)) {&#10;            Row(verticalAlignment = Alignment.CenterVertically) {&#10;                Icon(&#10;                    Icons.Default.CalendarToday,&#10;                    contentDescription = null,&#10;                    tint = Color.White,&#10;                    modifier = Modifier.size(24.dp)&#10;                )&#10;                Spacer(modifier = Modifier.width(12.dp))&#10;                Text(&#10;                    text = &quot;Próximos 5 Días&quot;,&#10;                    style = MaterialTheme.typography.titleLarge,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            val dailyForecasts = forecast.list.groupBy { item -&gt;&#10;                SimpleDateFormat(&quot;yyyy-MM-dd&quot;, Locale.getDefault())&#10;                    .format(Date(item.dt * 1000))&#10;            }.values.take(5)&#10;&#10;            dailyForecasts.forEachIndexed { index, dayItems -&gt;&#10;                ModernDailyItem(dayItems, index == 0)&#10;                if (index &lt; dailyForecasts.size - 1) {&#10;                    HorizontalDivider(&#10;                        color = Color.White.copy(alpha = 0.2f),&#10;                        modifier = Modifier.padding(vertical = 12.dp)&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernDailyItem(dayItems: List&lt;ForecastItem&gt;, isToday: Boolean) {&#10;    val date = Date(dayItems.first().dt * 1000)&#10;    val dayName = if (isToday) &quot;Hoy&quot; else SimpleDateFormat(&quot;EEEE&quot;, Locale.getDefault()).format(date)&#10;    val maxTemp = dayItems.maxOf { it.main.tempMax }&#10;    val minTemp = dayItems.minOf { it.main.tempMin }&#10;    val mainWeather = dayItems[dayItems.size / 2].weather.firstOrNull()?.main ?: &quot;Clear&quot;&#10;    val maxPop = dayItems.maxOf { it.pop }&#10;&#10;    Row(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        verticalAlignment = Alignment.CenterVertically,&#10;        horizontalArrangement = Arrangement.SpaceBetween&#10;    ) {&#10;        Text(&#10;            text = dayName.replaceFirstChar {&#10;                if (it.isLowerCase()) it.titlecase() else it.toString()&#10;            },&#10;            style = MaterialTheme.typography.titleMedium,&#10;            color = Color.White,&#10;            fontWeight = if (isToday) FontWeight.Bold else FontWeight.Medium,&#10;            modifier = Modifier.weight(1f)&#10;        )&#10;&#10;        if (maxPop &gt; 0.1) {&#10;            Row(&#10;                verticalAlignment = Alignment.CenterVertically,&#10;                modifier = Modifier.padding(end = 16.dp)&#10;            ) {&#10;                Text(text = &quot;&quot;, fontSize = 18.sp)&#10;                Spacer(modifier = Modifier.width(4.dp))&#10;                Text(&#10;                    text = &quot;${(maxPop * 100).roundToInt()}%&quot;,&#10;                    style = MaterialTheme.typography.bodyMedium,&#10;                    color = Color(0xFF64B5F6),&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;            }&#10;        }&#10;&#10;        Text(&#10;            text = getWeatherIcon(mainWeather),&#10;            fontSize = 32.sp,&#10;            modifier = Modifier.padding(horizontal = 16.dp)&#10;        )&#10;&#10;        Column(horizontalAlignment = Alignment.End) {&#10;            Text(&#10;                text = &quot;${maxTemp.roundToInt()}°&quot;,&#10;                style = MaterialTheme.typography.titleMedium,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.White&#10;            )&#10;            Text(&#10;                text = &quot;${minTemp.roundToInt()}°&quot;,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                color = Color.White.copy(alpha = 0.7f)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun GlassmorphicDetailsGrid(weather: WeatherResponse) {&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(12.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            GlassDetailCard(&#10;                icon = &quot;️&quot;,&#10;                label = &quot;Sensación Térmica&quot;,&#10;                value = &quot;${weather.main.feelsLike.roundToInt()}°&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;            GlassDetailCard(&#10;                icon = &quot;&quot;,&#10;                label = &quot;Humedad&quot;,&#10;                value = &quot;${weather.main.humidity}%&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;        }&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            GlassDetailCard(&#10;                icon = &quot;&quot;,&#10;                label = &quot;Viento&quot;,&#10;                value = &quot;${weather.wind.speed} m/s&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;            GlassDetailCard(&#10;                icon = &quot;️&quot;,&#10;                label = &quot;Visibilidad&quot;,&#10;                value = &quot;${weather.visibility / 1000} km&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;        }&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            GlassDetailCard(&#10;                icon = &quot;&quot;,&#10;                label = &quot;Presión&quot;,&#10;                value = &quot;${weather.main.pressure} hPa&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;            GlassDetailCard(&#10;                icon = &quot;☁️&quot;,&#10;                label = &quot;Nubosidad&quot;,&#10;                value = &quot;${weather.clouds.all}%&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun GlassDetailCard(&#10;    icon: String,&#10;    label: String,&#10;    value: String,&#10;    modifier: Modifier = Modifier&#10;) {&#10;    Card(&#10;        modifier = modifier,&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White.copy(alpha = 0.25f)&#10;        ),&#10;        shape = RoundedCornerShape(20.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(20.dp),&#10;            horizontalAlignment = Alignment.Start&#10;        ) {&#10;            Text(text = icon, fontSize = 32.sp)&#10;            Spacer(modifier = Modifier.height(12.dp))&#10;            Text(&#10;                text = label,&#10;                style = MaterialTheme.typography.bodySmall,&#10;                color = Color.White.copy(alpha = 0.8f),&#10;                fontWeight = FontWeight.Medium&#10;            )&#10;            Spacer(modifier = Modifier.height(4.dp))&#10;            Text(&#10;                text = value,&#10;                style = MaterialTheme.typography.headlineSmall,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.White&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernAirQualityCard(airQuality: AirQualityResponse) {&#10;    val aqi = airQuality.list.firstOrNull()?.main?.aqi ?: 1&#10;    val (aqiText, aqiColor) = getAirQualityInfo(aqi)&#10;&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White.copy(alpha = 0.25f)&#10;        ),&#10;        shape = RoundedCornerShape(24.dp)&#10;    ) {&#10;        Column(modifier = Modifier.padding(20.dp)) {&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Text(text = &quot;️&quot;, fontSize = 32.sp)&#10;                    Spacer(modifier = Modifier.width(12.dp))&#10;                    Column {&#10;                        Text(&#10;                            text = &quot;Calidad del Aire&quot;,&#10;                            style = MaterialTheme.typography.titleLarge,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = Color.White&#10;                        )&#10;                        Text(&#10;                            text = &quot;AQI Index&quot;,&#10;                            style = MaterialTheme.typography.bodySmall,&#10;                            color = Color.White.copy(alpha = 0.7f)&#10;                        )&#10;                    }&#10;                }&#10;&#10;                Surface(&#10;                    color = aqiColor,&#10;                    shape = RoundedCornerShape(16.dp)&#10;                ) {&#10;                    Text(&#10;                        text = aqiText,&#10;                        modifier = Modifier.padding(horizontal = 16.dp, vertical = 8.dp),&#10;                        style = MaterialTheme.typography.titleMedium,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = Color.White&#10;                    )&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(20.dp))&#10;&#10;            val components = airQuality.list.firstOrNull()?.components&#10;            if (components != null) {&#10;                Row(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;                ) {&#10;                    AirComponentBox(&quot;PM2.5&quot;, components.pm2_5.roundToInt().toString(), Modifier.weight(1f))&#10;                    AirComponentBox(&quot;PM10&quot;, components.pm10.roundToInt().toString(), Modifier.weight(1f))&#10;                    AirComponentBox(&quot;O₃&quot;, components.o3.roundToInt().toString(), Modifier.weight(1f))&#10;                    AirComponentBox(&quot;NO₂&quot;, components.no2.roundToInt().toString(), Modifier.weight(1f))&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun AirComponentBox(label: String, value: String, modifier: Modifier = Modifier) {&#10;    Surface(&#10;        modifier = modifier,&#10;        color = Color.White.copy(alpha = 0.2f),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(12.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = label,&#10;                style = MaterialTheme.typography.bodySmall,&#10;                color = Color.White.copy(alpha = 0.8f),&#10;                fontWeight = FontWeight.Medium&#10;            )&#10;            Spacer(modifier = Modifier.height(4.dp))&#10;            Text(&#10;                text = value,&#10;                style = MaterialTheme.typography.titleMedium,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.White&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ModernSunCard(sys: Sys) {&#10;    val sunrise = SimpleDateFormat(&quot;HH:mm&quot;, Locale.getDefault()).format(Date(sys.sunrise * 1000))&#10;    val sunset = SimpleDateFormat(&quot;HH:mm&quot;, Locale.getDefault()).format(Date(sys.sunset * 1000))&#10;&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White.copy(alpha = 0.25f)&#10;        ),&#10;        shape = RoundedCornerShape(24.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(24.dp),&#10;            horizontalArrangement = Arrangement.SpaceEvenly&#10;        ) {&#10;            Column(&#10;                horizontalAlignment = Alignment.CenterHorizontally,&#10;                modifier = Modifier.weight(1f)&#10;            ) {&#10;                Surface(&#10;                    color = Color(0xFFFFA726).copy(alpha = 0.3f),&#10;                    shape = CircleShape,&#10;                    modifier = Modifier.size(64.dp)&#10;                ) {&#10;                    Box(contentAlignment = Alignment.Center) {&#10;                        Text(text = &quot;&quot;, fontSize = 32.sp)&#10;                    }&#10;                }&#10;                Spacer(modifier = Modifier.height(12.dp))&#10;                Text(&#10;                    text = &quot;Amanecer&quot;,&#10;                    style = MaterialTheme.typography.bodyMedium,&#10;                    color = Color.White.copy(alpha = 0.8f)&#10;                )&#10;                Text(&#10;                    text = sunrise,&#10;                    style = MaterialTheme.typography.headlineSmall,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;&#10;            HorizontalDivider(&#10;                color = Color.White.copy(alpha = 0.3f),&#10;                modifier = Modifier&#10;                    .height(100.dp)&#10;                    .width(1.dp)&#10;            )&#10;&#10;            Column(&#10;                horizontalAlignment = Alignment.CenterHorizontally,&#10;                modifier = Modifier.weight(1f)&#10;            ) {&#10;                Surface(&#10;                    color = Color(0xFFFF7043).copy(alpha = 0.3f),&#10;                    shape = CircleShape,&#10;                    modifier = Modifier.size(64.dp)&#10;                ) {&#10;                    Box(contentAlignment = Alignment.Center) {&#10;                        Text(text = &quot;&quot;, fontSize = 32.sp)&#10;                    }&#10;                }&#10;                Spacer(modifier = Modifier.height(12.dp))&#10;                Text(&#10;                    text = &quot;Atardecer&quot;,&#10;                    style = MaterialTheme.typography.bodyMedium,&#10;                    color = Color.White.copy(alpha = 0.8f)&#10;                )&#10;                Text(&#10;                    text = sunset,&#10;                    style = MaterialTheme.typography.headlineSmall,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = Color.White&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun ModernSearchDialog(&#10;    query: String,&#10;    suggestions: List&lt;CitySearchResult&gt;,&#10;    isSearching: Boolean,&#10;    onQueryChange: (String) -&gt; Unit,&#10;    onSelectCity: (CitySearchResult) -&gt; Unit,&#10;    onDismiss: () -&gt; Unit&#10;) {&#10;    Dialog(onDismissRequest = onDismiss) {&#10;        Card(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            colors = CardDefaults.cardColors(&#10;                containerColor = Color.White&#10;            ),&#10;            shape = RoundedCornerShape(28.dp),&#10;            elevation = CardDefaults.cardElevation(8.dp)&#10;        ) {&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(24.dp)&#10;            ) {&#10;                Row(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    horizontalArrangement = Arrangement.SpaceBetween,&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    Text(&#10;                        text = &quot;Buscar Ciudad&quot;,&#10;                        style = MaterialTheme.typography.headlineSmall,&#10;                        fontWeight = FontWeight.Bold&#10;                    )&#10;                    IconButton(onClick = onDismiss) {&#10;                        Icon(Icons.Default.Close, contentDescription = &quot;Cerrar&quot;)&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                OutlinedTextField(&#10;                    value = query,&#10;                    onValueChange = onQueryChange,&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    placeholder = { Text(&quot;Escribe el nombre de la ciudad...&quot;) },&#10;                    leadingIcon = { Icon(Icons.Default.Search, contentDescription = null) },&#10;                    trailingIcon = {&#10;                        if (isSearching) {&#10;                            CircularProgressIndicator(modifier = Modifier.size(24.dp), strokeWidth = 2.dp)&#10;                        } else if (query.isNotEmpty()) {&#10;                            IconButton(onClick = { onQueryChange(&quot;&quot;) }) {&#10;                                Icon(Icons.Default.Clear, contentDescription = &quot;Limpiar&quot;)&#10;                            }&#10;                        }&#10;                    },&#10;                    singleLine = true,&#10;                    shape = RoundedCornerShape(16.dp),&#10;                    colors = OutlinedTextFieldDefaults.colors(&#10;                        focusedBorderColor = Color(0xFF4A90E2),&#10;                        unfocusedBorderColor = Color.Gray.copy(alpha = 0.3f)&#10;                    )&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                // Sugerencias&#10;                if (suggestions.isNotEmpty()) {&#10;                    Text(&#10;                        text = &quot;Sugerencias:&quot;,&#10;                        style = MaterialTheme.typography.titleSmall,&#10;                        fontWeight = FontWeight.SemiBold,&#10;                        color = Color.Gray&#10;                    )&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;&#10;                    LazyColumn(&#10;                        modifier = Modifier.heightIn(max = 300.dp),&#10;                        verticalArrangement = Arrangement.spacedBy(4.dp)&#10;                    ) {&#10;                        items(suggestions) { city -&gt;&#10;                            SuggestionItem(city, onSelectCity)&#10;                        }&#10;                    }&#10;                } else if (query.length &gt;= 2 &amp;&amp; !isSearching) {&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(32.dp),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;                            Text(text = &quot;&quot;, fontSize = 48.sp)&#10;                            Spacer(modifier = Modifier.height(8.dp))&#10;                            Text(&#10;                                text = &quot;No se encontraron ciudades&quot;,&#10;                                style = MaterialTheme.typography.bodyMedium,&#10;                                color = Color.Gray&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun SuggestionItem(&#10;    city: CitySearchResult,&#10;    onSelect: (CitySearchResult) -&gt; Unit&#10;) {&#10;    Surface(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .clickable { onSelect(city) },&#10;        color = Color.Gray.copy(alpha = 0.1f),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier.padding(16.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Surface(&#10;                color = Color(0xFF4A90E2).copy(alpha = 0.2f),&#10;                shape = CircleShape,&#10;                modifier = Modifier.size(40.dp)&#10;            ) {&#10;                Box(contentAlignment = Alignment.Center) {&#10;                    Icon(&#10;                        Icons.Default.LocationOn,&#10;                        contentDescription = null,&#10;                        tint = Color(0xFF4A90E2),&#10;                        modifier = Modifier.size(24.dp)&#10;                    )&#10;                }&#10;            }&#10;            Spacer(modifier = Modifier.width(12.dp))&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Text(&#10;                    text = city.name,&#10;                    style = MaterialTheme.typography.titleMedium,&#10;                    fontWeight = FontWeight.SemiBold&#10;                )&#10;                Text(&#10;                    text = buildString {&#10;                        city.state?.let { append(&quot;$it, &quot;) }&#10;                        append(city.country)&#10;                    },&#10;                    style = MaterialTheme.typography.bodySmall,&#10;                    color = Color.Gray&#10;                )&#10;            }&#10;            Icon(&#10;                Icons.Default.ChevronRight,&#10;                contentDescription = null,&#10;                tint = Color.Gray&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;// Funciones auxiliares&#10;fun getModernBackgroundGradient(condition: String): Brush {&#10;    return when (condition) {&#10;        &quot;Clear&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF4A90E2),&#10;                Color(0xFF50B5FF),&#10;                Color(0xFF63C5FF)&#10;            )&#10;        )&#10;        &quot;Clouds&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF546E7A),&#10;                Color(0xFF607D8B),&#10;                Color(0xFF78909C)&#10;            )&#10;        )&#10;        &quot;Rain&quot;, &quot;Drizzle&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF455A64),&#10;                Color(0xFF546E7A),&#10;                Color(0xFF607D8B)&#10;            )&#10;        )&#10;        &quot;Thunderstorm&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF263238),&#10;                Color(0xFF37474F),&#10;                Color(0xFF455A64)&#10;            )&#10;        )&#10;        &quot;Snow&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF90A4AE),&#10;                Color(0xFFB0BEC5),&#10;                Color(0xFFCFD8DC)&#10;            )&#10;        )&#10;        &quot;Mist&quot;, &quot;Fog&quot;, &quot;Haze&quot; -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF78909C),&#10;                Color(0xFF90A4AE),&#10;                Color(0xFFB0BEC5)&#10;            )&#10;        )&#10;        else -&gt; Brush.verticalGradient(&#10;            colors = listOf(&#10;                Color(0xFF4A90E2),&#10;                Color(0xFF50B5FF),&#10;                Color(0xFF63C5FF)&#10;            )&#10;        )&#10;    }&#10;}&#10;&#10;fun getTimeAgo(timestamp: Long): String {&#10;    val diff = System.currentTimeMillis() - timestamp&#10;    val minutes = diff / (60 * 1000)&#10;    return when {&#10;        minutes &lt; 1 -&gt; &quot;Actualizado ahora&quot;&#10;        minutes &lt; 60 -&gt; &quot;Actualizado hace $minutes min&quot;&#10;        else -&gt; {&#10;            val hours = minutes / 60&#10;            &quot;Actualizado hace $hours h&quot;&#10;        }&#10;    }&#10;}&#10;&#10;private fun abs(l: Long): Long = if (l &lt; 0) -l else l" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/clima/viewmodel/WeatherViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/clima/viewmodel/WeatherViewModel.kt" />
              <option name="originalContent" value="package com.example.clima.viewmodel&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.clima.data.models.AirQualityResponse&#10;import com.example.clima.data.models.ForecastResponse&#10;import com.example.clima.data.models.WeatherResponse&#10;import com.example.clima.data.repository.WeatherRepository&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;sealed class WeatherUiState {&#10;    object Loading : WeatherUiState()&#10;    data class Success(&#10;        val currentWeather: WeatherResponse,&#10;        val forecast: ForecastResponse?,&#10;        val airQuality: AirQualityResponse?&#10;    ) : WeatherUiState()&#10;    data class Error(val message: String) : WeatherUiState()&#10;}&#10;&#10;class WeatherViewModel : ViewModel() {&#10;&#10;    private val repository = WeatherRepository()&#10;&#10;    private val _uiState = MutableStateFlow&lt;WeatherUiState&gt;(WeatherUiState.Loading)&#10;    val uiState: StateFlow&lt;WeatherUiState&gt; = _uiState.asStateFlow()&#10;&#10;    private val _searchQuery = MutableStateFlow(&quot;&quot;)&#10;    val searchQuery: StateFlow&lt;String&gt; = _searchQuery.asStateFlow()&#10;&#10;    fun updateSearchQuery(query: String) {&#10;        _searchQuery.value = query&#10;    }&#10;&#10;    fun loadWeatherData(lat: Double, lon: Double) {&#10;        viewModelScope.launch {&#10;            _uiState.value = WeatherUiState.Loading&#10;&#10;            val weatherResult = repository.getCurrentWeather(lat, lon)&#10;&#10;            if (weatherResult.isSuccess) {&#10;                val weather = weatherResult.getOrNull()!!&#10;&#10;                // Cargar pronóstico y calidad del aire en paralelo&#10;                val forecastResult = repository.getForecast(lat, lon)&#10;                val airQualityResult = repository.getAirQuality(lat, lon)&#10;&#10;                _uiState.value = WeatherUiState.Success(&#10;                    currentWeather = weather,&#10;                    forecast = forecastResult.getOrNull(),&#10;                    airQuality = airQualityResult.getOrNull()&#10;                )&#10;            } else {&#10;                _uiState.value = WeatherUiState.Error(&#10;                    weatherResult.exceptionOrNull()?.message ?: &quot;Error desconocido&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;&#10;    fun searchCity(city: String) {&#10;        viewModelScope.launch {&#10;            _uiState.value = WeatherUiState.Loading&#10;&#10;            val weatherResult = repository.getCurrentWeatherByCity(city)&#10;&#10;            if (weatherResult.isSuccess) {&#10;                val weather = weatherResult.getOrNull()!!&#10;                val lat = weather.coord.lat&#10;                val lon = weather.coord.lon&#10;&#10;                val forecastResult = repository.getForecast(lat, lon)&#10;                val airQualityResult = repository.getAirQuality(lat, lon)&#10;&#10;                _uiState.value = WeatherUiState.Success(&#10;                    currentWeather = weather,&#10;                    forecast = forecastResult.getOrNull(),&#10;                    airQuality = airQualityResult.getOrNull()&#10;                )&#10;            } else {&#10;                _uiState.value = WeatherUiState.Error(&#10;                    &quot;No se pudo encontrar la ciudad&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;&#10;    fun retry(lat: Double, lon: Double) {&#10;        loadWeatherData(lat, lon)&#10;    }&#10;}&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.clima.viewmodel&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.clima.data.api.CitySearchResult&#10;import com.example.clima.data.models.AirQualityResponse&#10;import com.example.clima.data.models.ForecastResponse&#10;import com.example.clima.data.models.WeatherResponse&#10;import com.example.clima.data.repository.WeatherRepository&#10;import kotlinx.coroutines.Job&#10;import kotlinx.coroutines.delay&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;sealed class WeatherUiState {&#10;    object Loading : WeatherUiState()&#10;    data class Success(&#10;        val currentWeather: WeatherResponse,&#10;        val forecast: ForecastResponse?,&#10;        val airQuality: AirQualityResponse?,&#10;        val lastUpdated: Long = System.currentTimeMillis()&#10;    ) : WeatherUiState()&#10;    data class Error(val message: String) : WeatherUiState()&#10;}&#10;&#10;class WeatherViewModel : ViewModel() {&#10;&#10;    private val repository = WeatherRepository()&#10;&#10;    private val _uiState = MutableStateFlow&lt;WeatherUiState&gt;(WeatherUiState.Loading)&#10;    val uiState: StateFlow&lt;WeatherUiState&gt; = _uiState.asStateFlow()&#10;&#10;    private val _searchQuery = MutableStateFlow(&quot;&quot;)&#10;    val searchQuery: StateFlow&lt;String&gt; = _searchQuery.asStateFlow()&#10;&#10;    private val _citySuggestions = MutableStateFlow&lt;List&lt;CitySearchResult&gt;&gt;(emptyList())&#10;    val citySuggestions: StateFlow&lt;List&lt;CitySearchResult&gt;&gt; = _citySuggestions.asStateFlow()&#10;&#10;    private val _isSearching = MutableStateFlow(false)&#10;    val isSearching: StateFlow&lt;Boolean&gt; = _isSearching.asStateFlow()&#10;&#10;    private var searchJob: Job? = null&#10;    private var autoRefreshJob: Job? = null&#10;&#10;    private var currentLat: Double = 0.0&#10;    private var currentLon: Double = 0.0&#10;&#10;    fun updateSearchQuery(query: String) {&#10;        _searchQuery.value = query&#10;&#10;        // Cancelar búsqueda anterior&#10;        searchJob?.cancel()&#10;&#10;        if (query.length &lt; 2) {&#10;            _citySuggestions.value = emptyList()&#10;            return&#10;        }&#10;&#10;        // Debounce: esperar 500ms antes de buscar&#10;        searchJob = viewModelScope.launch {&#10;            delay(500)&#10;            searchCities(query)&#10;        }&#10;    }&#10;&#10;    private fun searchCities(query: String) {&#10;        viewModelScope.launch {&#10;            _isSearching.value = true&#10;            val result = repository.searchCities(query)&#10;            if (result.isSuccess) {&#10;                _citySuggestions.value = result.getOrNull() ?: emptyList()&#10;            } else {&#10;                _citySuggestions.value = emptyList()&#10;            }&#10;            _isSearching.value = false&#10;        }&#10;    }&#10;&#10;    fun selectCity(city: CitySearchResult) {&#10;        _searchQuery.value = &quot;&quot;&#10;        _citySuggestions.value = emptyList()&#10;        loadWeatherData(city.lat, city.lon)&#10;    }&#10;&#10;    fun clearSuggestions() {&#10;        _citySuggestions.value = emptyList()&#10;        _searchQuery.value = &quot;&quot;&#10;    }&#10;&#10;    fun loadWeatherData(lat: Double, lon: Double) {&#10;        currentLat = lat&#10;        currentLon = lon&#10;&#10;        viewModelScope.launch {&#10;            _uiState.value = WeatherUiState.Loading&#10;&#10;            // Obtener el nombre de la ciudad desde las coordenadas GPS&#10;            val cityNameResult = repository.getCityNameFromCoordinates(lat, lon)&#10;            val cityName = cityNameResult.getOrNull() ?: &quot;Ubicación desconocida&quot;&#10;&#10;            val weatherResult = repository.getCurrentWeather(lat, lon)&#10;&#10;            if (weatherResult.isSuccess) {&#10;                var weather = weatherResult.getOrNull()!!&#10;&#10;                // Reemplazar el nombre que viene de la API con el nombre correcto de la ciudad&#10;                weather = weather.copy(name = cityName.substringBefore(&quot;,&quot;))&#10;&#10;                // Cargar pronóstico y calidad del aire en paralelo&#10;                val forecastResult = repository.getForecast(lat, lon)&#10;                val airQualityResult = repository.getAirQuality(lat, lon)&#10;&#10;                _uiState.value = WeatherUiState.Success(&#10;                    currentWeather = weather,&#10;                    forecast = forecastResult.getOrNull(),&#10;                    airQuality = airQualityResult.getOrNull(),&#10;                    lastUpdated = System.currentTimeMillis()&#10;                )&#10;&#10;                // Iniciar auto-refresh cada 10 minutos&#10;                startAutoRefresh()&#10;            } else {&#10;                _uiState.value = WeatherUiState.Error(&#10;                    weatherResult.exceptionOrNull()?.message ?: &quot;Error desconocido&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;&#10;    fun searchCity(city: String) {&#10;        viewModelScope.launch {&#10;            _uiState.value = WeatherUiState.Loading&#10;&#10;            val weatherResult = repository.getCurrentWeatherByCity(city)&#10;&#10;            if (weatherResult.isSuccess) {&#10;                val weather = weatherResult.getOrNull()!!&#10;                val lat = weather.coord.lat&#10;                val lon = weather.coord.lon&#10;&#10;                currentLat = lat&#10;                currentLon = lon&#10;&#10;                val forecastResult = repository.getForecast(lat, lon)&#10;                val airQualityResult = repository.getAirQuality(lat, lon)&#10;&#10;                _uiState.value = WeatherUiState.Success(&#10;                    currentWeather = weather,&#10;                    forecast = forecastResult.getOrNull(),&#10;                    airQuality = airQualityResult.getOrNull(),&#10;                    lastUpdated = System.currentTimeMillis()&#10;                )&#10;&#10;                startAutoRefresh()&#10;            } else {&#10;                _uiState.value = WeatherUiState.Error(&#10;                    &quot;No se pudo encontrar la ciudad&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;&#10;    fun retry(lat: Double, lon: Double) {&#10;        loadWeatherData(lat, lon)&#10;    }&#10;&#10;    private fun startAutoRefresh() {&#10;        // Cancelar refresh anterior si existe&#10;        autoRefreshJob?.cancel()&#10;&#10;        // Auto-refresh cada 10 minutos&#10;        autoRefreshJob = viewModelScope.launch {&#10;            while (true) {&#10;                delay(10 * 60 * 1000) // 10 minutos&#10;                if (currentLat != 0.0 &amp;&amp; currentLon != 0.0) {&#10;                    refreshWeatherData()&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    private suspend fun refreshWeatherData() {&#10;        if (currentLat == 0.0 &amp;&amp; currentLon == 0.0) return&#10;&#10;        // Obtener el nombre de la ciudad desde las coordenadas GPS&#10;        val cityNameResult = repository.getCityNameFromCoordinates(currentLat, currentLon)&#10;        val cityName = cityNameResult.getOrNull() ?: &quot;Ubicación desconocida&quot;&#10;&#10;        val weatherResult = repository.getCurrentWeather(currentLat, currentLon)&#10;&#10;        if (weatherResult.isSuccess) {&#10;            var weather = weatherResult.getOrNull()!!&#10;&#10;            // Reemplazar el nombre que viene de la API con el nombre correcto de la ciudad&#10;            weather = weather.copy(name = cityName.substringBefore(&quot;,&quot;))&#10;&#10;            val forecastResult = repository.getForecast(currentLat, currentLon)&#10;            val airQualityResult = repository.getAirQuality(currentLat, currentLon)&#10;&#10;            _uiState.value = WeatherUiState.Success(&#10;                currentWeather = weather,&#10;                forecast = forecastResult.getOrNull(),&#10;                airQuality = airQualityResult.getOrNull(),&#10;                lastUpdated = System.currentTimeMillis()&#10;            )&#10;        }&#10;    }&#10;&#10;    override fun onCleared() {&#10;        super.onCleared()&#10;        autoRefreshJob?.cancel()&#10;        searchJob?.cancel()&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>